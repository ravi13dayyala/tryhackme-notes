## NMAP (Network Mapper) Host Discovery
- Nmap was created by Gordon Lyon (Fyodor), a network security expert and open source programmer. It was released in 1997. Nmap, short for Network Mapper, is free, open-source software released under GPL license. Nmap is an industry-standard tool for mapping networks, identifying live hosts, and discovering running services. Nmap’s scripting engine can further extend its functionality, from fingerprinting services to exploiting vulnerabilities.
#### Host Discovery Using ARP :
- If you want to use Nmap to discover online hosts without port-scanning the live systems, you can issue `nmap -sn TARGETS`.
- If you want Nmap only to perform an ARP scan without port-scanning, you can use `nmap -PR -sn TARGETS`, where -PR indicates that you only want an ARP scan.
- Mentioning the scanner built around ARP queries: `arp-scan`. Lets say to san the all the valid ip addresses on the local network, we can use `arp-scan --localnet` or simply `arp-scan -l`. Or if we have multiple interfaces on machine and we are interested in one of them, we do `sudo arp-scan -I eth0 -l`.
- Plese note that we can yield same ARP Traffic (observed by tcpdump, wireshark or any similar tool) with both of `nmap -PR -sn TARGETS` and `arp-scan TARGETS`.

#### Host Discovery Using ICMP:
- Remember that an ARP query will precede the ICMP request if your target is on the same subnet.
- To use ICMP echo request to discover live hosts, add the option `-PE`. (Remember to add `-sn` if you don’t want to follow that with a port scan.) 
- an ICMP echo scan works by sending an ICMP echo request and expects the target to reply with an ICMP echo reply if it is online.  
- Commnd `sudo nmap -PE -sn TARGETS` can scan with ARP ICMP ping on targets
- Adding the `-PP` option tells Nmap to use timestamp request (ICMP Type 13) and checks whether it will get a Timestamp reply (ICMP Type 14). Fr example: `sudo nmap -PP -sn TARGETS`
- Similarly, Nmap uses address mask queries (ICMP Type 17) and checks whether it gets an address mask reply (ICMP Type 18). This scan can be enabled with the option `-PM`. For Example: `sudo nmap -PM -sn TARGETS`

#### Host Discovery Using TCP and UDP:
- `TCP SYN PING`:  We can send a packet with the SYN (Synchronize) flag set to a TCP port, 80 by default, and wait for a response. An open port should reply with a SYN/ACK (Acknowledge); a closed port would result in an RST (Reset). We dont really care about the state of port in this case.
- If you want Nmap to use TCP SYN ping, you can do so via the option `-PS` followed by the port number, range, list, or a combination of them. For example, -PS21 will target port 21
- Privileged users (root and sudoers) can send TCP SYN packets and don’t need to complete the TCP 3-way handshake even if the port is open. . Unprivileged users have no choice but to complete the 3-way handshake if the port is open.
- `TCP ACK Ping`: Sends a packet with an ACK flag set. You must be running Nmap as a privileged user to be able to accomplish this. If you try it as an unprivileged user, Nmap will attempt a 3-way handshake.
- Here, We are sending TCP packet with an ACK flag set to all the targets. So, targets which are up should reply with TCP packet with an RST flag set.
- To use TCP ACK ping with nmap, we use flag `-PA`. For example  `sudo nmap -PA -sn TARGETS` to discover the online hosts on targtet's network.
- `UDP PIng`:Contrary to TCP SYN ping, sending a UDP packet to an open port is not expected to lead to any reply. However, if we send a UDP packet to a closed UDP port, we expect to get an ICMP port unreachable packet; this indicates that the target system is up and available.
- Nmap uses `-PU` for UDP ping. For example: `sudo nmap -PU -sn TARGETS`

#### Reverse DNS Lookup:
- Nmap’s default behaviour is to use reverse-DNS online hosts. Because the hostnames can reveal a lot, this can be a helpful step. However, if you don’t want to send such DNS queries, you use `-n` to skip this step.
- By default, Nmap will look up online hosts; however, you can use the option `-R` to query the DNS server even for offline hosts. If you want to use a specific DNS server, you can add the `--dns-servers` DNS_SERVER option.

## Nmap Basic Port Scans
- `TCP Connect Scan`: TCP connect scan works by completing the TCP 3-way handshake. In standard TCP connection establishment, the client sends a TCP packet with `SYN` flag set, and the server responds with `SYN/ACK` if the port is open; finally, the client completes the 3-way handshake by sending an `ACK`. A closed TCP port responds to a SYN packet with `RST/ACK` to indicate that it is not open.
- You can choose to run TCP connect scan using `-sT` with nmap. For example: `nmap -sT 10.49.140.143`
- We can use `-F` to enable fast mode and decrease the number of scanned ports from 1000 (default) to 100 most common ports.
- `TCP SYN SCan`: Default scan mode is SYN scan, and it requires a privileged (root or sudoer) user to run it.
-  We are interested in learning whether the TCP port is open, not establishing a TCP connection. Hence the connection is torn as soon as its state is confirmed by sending a `RST/ACK` (closed) or `SYS/ACK` (open) (only privilaged users allowed) by sending the `RST` flag. We can select this scan type by using the `-sS` option. 
- `UDP Scan`: UDP is a connectionless protocol, and hence it does not require any handshake for connection establishment. We cannot guarantee that a service listening on a UDP port would respond to our packets. However, if a UDP packet is sent to a closed port, an ICMP port unreachable error (type 3, code 3) is returned. 
- We can select UDP scan using the `-sU` option; For example: `sudo nmap -sU 10.48.177.222`

## Fine-Tuning Scope and Performance
- We can choose to control the packet rate using `--min-rate <number>` and `--max-rate <number>`. For example, `--max-rate 10` or `--max-rate=10` ensures that your scanner is not sending more than ten packets per second.
- We can control probing parallelization using `--min-parallelism <numprobes>` and `--max-parallelism <numprobes>`
#### Ports 
- We can specify the ports you want to scan instead of the default 1000 ports.
- port list: `-p22,80,443`
- port range: `-p1-1023`
- all ports (0 - 65535): `-p-`
- Top 100 ports: `-F`
- Top 10 ports: `--top-ports 10`

#### scan timing
- We can control the scan timing using -T<0-5>. -T0 is the slowest (paranoid), while -T5 is the fastest.
- paranoid (T0), sneaky (T1), polite (T2), normal (T3), aggressive (T4), insane (T5)


















